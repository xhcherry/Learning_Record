# TIM定时中断

定时器共四个部分，分为八个小节笔记。本小节为第一部分第一节。

在第一部分，是定时器的基本定时的功能：定时中断功能、内外时钟源选择

在第二部分，是定时器的输出比较功能，最常见的用途是产生PWM波形，用于驱动电机等设备

在第三部分，是定时器的输入捕获功能和主从触发模式，来实现测量方波频率

在第四部分，是定时器的编码器接口，能够更加方便读取正交编码器的输出波形，编码电机测速

## TIM简介
TIM（Timer）定时器，定时触发中断

定时器本质上就是一个计数器

定时器可以对输入的时钟进行计数（在stm32中定时器的基准时钟一般是主频72MHz，如果对72MHz记72个数，那就是1MHz也就是1us的时间（72MHz就是1秒记72M个数，可以理解为对72个数计数1M次，记72个数的频率就是1MHz，用时1us）），如果记72000个数，那就是1KHz也就是1ms的时间，并在计数值达到设定值时触发中断

stm32的定时器拥有16位（2的16次方是65536）的计数器（计数器就是用来执行计数定时的寄存器，每来一个时钟，计数器加1）、预分频器（可以对计数器的时钟进行分频，让计数更加灵活）、自动重装寄存器（是计数的目标值，计多少个时钟申请中断）的时基单元，在72MHz计数时钟下可以实现最大59.65s的定时。

预分频值（PSC）、自动重装载值（ARR）。

定时器的计数频率 = 时钟频率 / （PSC + 1）

最大定时时间 = （ARR + 1）/ 定时器的计数频率

即，最大定时时间 = (ARR + 1) * (PSC + 1) / 时钟频率

不仅具备基本的定时中断功能，而且还包含内外时钟源选择、输入捕获、输出比较、编码器接口、主从触发模式等多种功能

根据复杂度和应用场景分为了高级定时器、通用定时器、基本定时器三种类型
|类型|编号|总线|功能|
|:-:|:-:|:-:|:-:|
|高级定时器|TIM1、TIM8|APB2|拥有通用定时器全部功能，并额外具有重复计数器、死区生成、互补输出、刹车输入等功能|
|通用定时器|TIM2、TIM3、TIM4、TIM5|APB1|拥有基本定时器全部功能，并额外具有内外时钟源选择、输入捕获、输出比较、编码器接口、主从触发模式等功能|
|基本定时器|TIM6、TIM7|APB1|拥有定时中断、主模式触发DAC的功能|

除了TIM1-8，在库函数中还出现了TIM9、10、11等（这些一般都用不到）

高级定时器额外具有的重复计数器、死区生成、互补输出、刹车输入等，这些功能主要是为了三相无刷电机的驱动设计的

STM32F103C8T6定时器资源：TIM1、TIM2、TIM3、TIM4；不同的型号，定时器的数量是不同的

## 基本定时器
理解时基单元的工作流程（定时器产生中断的全部流程）、主模式触发DAC的功能，如下内容：
### 基本定时器时基单元

