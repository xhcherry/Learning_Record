# TIM编码器接口

## 编码器接口简介

Encoder Interface 编码器接口

工作流程概述：编码器接口可接收增量（正交）编码器的信号，根据编码器旋转产生的正交信号脉冲，自动控制CNT自增或自减，从而指示编码器的位置、旋转方向和旋转速度

每个高级定时器和通用定时器都拥有1个编码器接口（C8T6有四个定时器只能接4个编码器；硬件不够可以用外部中断，再中断里手动计数）

两个输入引脚借用了输入捕获的通道1和通道2

实验现象(下图)：一个编码器，有两个输出，一个是A相，一个是B相，然后接入到stm32定时器的编码器接口，编码器接口自动控制定时器时基单元中的CNT计数器进行自增或自减，比如初始化之后，CNT初始值为0，编码器右转CNT++，右转产生一个脉冲，CNT就加一次，左转同理;这个编码器接口相当于一个带有方向控制的外部时钟，同时控制这CNT的计数时钟和计数方向，CNT的值就表示了编码器的位置，若每隔一段时间取一次CNT的值，再把CNT清零，每次取出来的值就表示了编码器的速度，这个编码器测试实际上就是测频法测正交脉冲的频率，CNT计次，每隔一段时间取一次计次，就是测频法思路

编码器接口计次更高级，能根据旋转方向，不仅能自增还能自减，是带方向的计次

![](https://pic.xhcheats.cn/assets/2024/01/16/011424.png)


## 正交编码器

![](https://pic.xhcheats.cn/assets/2024/01/16/012448.png)

输出的两个方波信号，相位相差90度,转得越快频率越高

正转，超前90度

![](https://pic.xhcheats.cn/assets/2024/01/16/010659.png)

第一个时刻，A相上升沿，对应B相此时是低电平，也就是表里的第一行；第二个时刻，B相上升沿，对应A相高电平，表里第三行；第三个时刻，A相下降沿，对应B相高电平，表里第二行；第四个时刻，B相下降沿，对应A相低电平，表里第四行；循环就是正转

反转，滞后90度

![](https://pic.xhcheats.cn/assets/2024/01/16/010712.png)

第一个时刻，B相上升沿，对应A相此时是低电平，也就是表里的第三行；第二个时刻，A相上升沿，对应B相高电平，表里第一行；第三个时刻，B相下降沿，对应A相高电平，表里第四行；第四个时刻，A相下降沿，对应B相低电平，表里第二行；循环就是反转

正交信号比单独定义一个方向引脚的好处:正交信号精度更好，可以抗噪声

编码器电路结构

![](https://pic.xhcheats.cn/assets/2024/01/16/013718.png)

输出执行流程

![](https://pic.xhcheats.cn/assets/2024/01/16/013758.png)

## 编码器接口基本结构

![](https://pic.xhcheats.cn/assets/2024/01/16/013851.png)

## 工作模式
正转的状态都向上计数，反转的状态都向下计数

![](https://pic.xhcheats.cn/assets/2024/01/16/014209.png)

## 实例图(均不反相)

![](https://pic.xhcheats.cn/assets/2024/01/16/014353.png)

## 实例(TI1反相)

![](https://pic.xhcheats.cn/assets/2024/01/16/014726.png)

把任意一个引脚反相，就能反转计数方向了，想改变计数方向，可以直接把A，B引脚交换

## 对应手册内容

14.3.12